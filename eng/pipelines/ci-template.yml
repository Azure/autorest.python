parameters:
    installAutorest: false
    installTypeSpec: false
    installCadlRanch: false
    packageName: ""
    regenerate: false
    checkChange: true
    pythonCodeChecks: false
    updateToLatestTypespec: false
    createAlphaVersion: false

steps:
    - checkout: self
    - checkout: azure-sdk-tools
    - template: eng/common/testproxy/test-proxy-tool.yml@azure-sdk-tools
      parameters:
          TestProxy: true
          templateRoot: azure-sdk-tools
    - task: NodeTool@0
      displayName: "Install Node.js 16.x"
      inputs:
          versionSpec: "16.x"
    - task: UsePythonVersion@0
      displayName: "Use Python 3.11"
      inputs:
          versionSpec: 3.11

    - script: >
        python -u eng/scripts/init.py
        --update-to-latest-typespec=${{ parameters.updateToLatestTypespec }}
        --install-autorest=${{ parameters.installAutorest }}
        --install-typespec=${{ parameters.installTypeSpec }}
        --install-cadl-ranch=${{ parameters.installCadlRanch }}
      displayName: Run init script
      workingDirectory: $(Build.SourcesDirectory)/autorest.python

    - ${{ if eq(parameters.createAlphaVersion, true) }}:
      - script: >
          python -u eng/scripts/build.py
          --package="${{ parameters.packageName }}"
          --regenerate=${{ parameters.regenerate }}
          --check-change=${{ parameters.checkChange }}
          --code-checks=${{ parameters.pythonCodeChecks }}
          --version-suffix="-alpha.$(Build.BuildNumber)"
        name: build_script
        displayName: Run build script
        workingDirectory: $(Build.SourcesDirectory)/autorest.python
    - ${{ else }}:
      - script: >
          python -u eng/scripts/build.py
          --package="${{ parameters.packageName }}"
          --regenerate=${{ parameters.regenerate }}
          --check-change=${{ parameters.checkChange }}
          --code-checks=${{ parameters.pythonCodeChecks }}
        name: build_script
        displayName: Run build script
        workingDirectory: $(Build.SourcesDirectory)/autorest.python
