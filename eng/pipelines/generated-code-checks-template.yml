parameters:
    folderName: ""
    package: "autorest.python"
    checkCoverage: false

steps:
    - script: tox run -e ci
      displayName: Execute ${{ parameters.folderName }} tests - Python $(PythonVersion)
      workingDirectory: $(Build.SourcesDirectory)/autorest.python/packages/${{parameters.package}}/test/${{ parameters.folderName }}

    - script: tox run -e lint
      displayName: Lint ${{ parameters.folderName }} - Python $(PythonVersion)
      workingDirectory: $(Build.SourcesDirectory)/autorest.python/packages/${{parameters.package}}/test/${{ parameters.folderName }}
      condition: and(eq(variables['PythonVersion'], '3.10'), or(contains( '${{ parameters.folderName }}', 'version-tolerant'), eq('${{parameters.package}}', 'typespec-python')))

    - script: tox run -e mypy
      displayName: Mypy ${{ parameters.folderName }} - Python $(PythonVersion)
      workingDirectory: $(Build.SourcesDirectory)/autorest.python/packages/${{parameters.package}}/test/${{ parameters.folderName }}
      condition: and(eq(variables['PythonVersion'], '3.11'), or(contains('${{ parameters.folderName }}', 'version-tolerant'), eq('${{parameters.package}}', 'typespec-python')))

    - script: tox run -e pyright
      displayName: Pyright ${{ parameters.folderName }} - Python $(PythonVersion)
      workingDirectory: $(Build.SourcesDirectory)/autorest.python/packages/${{parameters.package}}/test/${{ parameters.folderName }}
      condition: and(eq(variables['PythonVersion'], '3.10'), or(contains('${{ parameters.folderName }}', 'version-tolerant'), eq('${{parameters.package}}', 'typespec-python')))

    - script: tox run -e apiview
      displayName: ApiView ${{ parameters.folderName }} - Python $(PythonVersion)
      workingDirectory: $(Build.SourcesDirectory)/autorest.python/packages/${{parameters.package}}/test/${{ parameters.folderName }}
      condition: eq(variables['PythonVersion'], '3.11')

    - script: cadl-ranch check-coverage http/ --configFile ./$(Build.SourcesDirectory)/autorest.python/packages/typespec-python/test/${{ parameters.folderName }}/cadl-ranch-config.yaml
      displayName: Check Coverage for ${{ parameters.folderName }}
      workingDirectory: $(Build.SourcesDirectory)/autorest.python/packages/typespec-python/node_modules/@azure-tools/cadl-ranch-specs
      condition: and(succeeded(), ${{ parameters.checkCoverage }})

    - publish: ./cadl-ranch-coverage.json
      artifact: CoverageReport - {{ parameters.folderName }}
      workingDirectory: $(Build.SourcesDirectory)/autorest.python/packages/${{parameters.package}}/test/${{ parameters.folderName }}
